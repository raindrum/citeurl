
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Library Reference - CiteURL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#library-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CiteURL" class="md-header__button md-logo" aria-label="CiteURL" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiteURL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Library Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/raindrum/citeurl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CiteURL" class="md-nav__button md-logo" aria-label="CiteURL" data-md-component="logo">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    CiteURL
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/raindrum/citeurl/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../frontends/" class="md-nav__link">
        CiteURL Frontends
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Library Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Library Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#citator" class="md-nav__link">
    Citator
  </a>
  
    <nav class="md-nav" aria-label="Citator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.cite" class="md-nav__link">
    cite()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.from_yaml" class="md-nav__link">
    from_yaml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.insert_links" class="md-nav__link">
    insert_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.list_cites" class="md-nav__link">
    list_cites()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.to_yaml" class="md-nav__link">
    to_yaml()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citation" class="md-nav__link">
    Citation
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citation.Citation.__contains__" class="md-nav__link">
    __contains__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citation.Citation.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template" class="md-nav__link">
    Template
  </a>
  
    <nav class="md-nav" aria-label="Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.cite" class="md-nav__link">
    cite()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.list_longform_cites" class="md-nav__link">
    list_longform_cites()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.to_yaml" class="md-nav__link">
    to_yaml()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokentype" class="md-nav__link">
    TokenType
  </a>
  
    <nav class="md-nav" aria-label="TokenType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenType.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenType.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenoperation" class="md-nav__link">
    TokenOperation
  </a>
  
    <nav class="md-nav" aria-label="TokenOperation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.modify_dict" class="md-nav__link">
    modify_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stringbuilder" class="md-nav__link">
    StringBuilder
  </a>
  
    <nav class="md-nav" aria-label="StringBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.StringBuilder.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.StringBuilder.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert_links" class="md-nav__link">
    insert_links()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cite" class="md-nav__link">
    cite()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list_cites" class="md-nav__link">
    list_cites()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../template-yamls/" class="md-nav__link">
        Writing Your Own Templates
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#citator" class="md-nav__link">
    Citator
  </a>
  
    <nav class="md-nav" aria-label="Citator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.cite" class="md-nav__link">
    cite()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.from_yaml" class="md-nav__link">
    from_yaml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.insert_links" class="md-nav__link">
    insert_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.list_cites" class="md-nav__link">
    list_cites()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.load_yaml" class="md-nav__link">
    load_yaml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Citator.to_yaml" class="md-nav__link">
    to_yaml()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citation" class="md-nav__link">
    Citation
  </a>
  
    <nav class="md-nav" aria-label="Citation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citation.Citation.__contains__" class="md-nav__link">
    __contains__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citation.Citation.__eq__" class="md-nav__link">
    __eq__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#template" class="md-nav__link">
    Template
  </a>
  
    <nav class="md-nav" aria-label="Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.cite" class="md-nav__link">
    cite()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.list_longform_cites" class="md-nav__link">
    list_longform_cites()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.citator.Template.to_yaml" class="md-nav__link">
    to_yaml()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokentype" class="md-nav__link">
    TokenType
  </a>
  
    <nav class="md-nav" aria-label="TokenType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenType.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenType.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenoperation" class="md-nav__link">
    TokenOperation
  </a>
  
    <nav class="md-nav" aria-label="TokenOperation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.modify_dict" class="md-nav__link">
    modify_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.TokenOperation.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stringbuilder" class="md-nav__link">
    StringBuilder
  </a>
  
    <nav class="md-nav" aria-label="StringBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.StringBuilder.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#citeurl.tokens.StringBuilder.to_dict" class="md-nav__link">
    to_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert_links" class="md-nav__link">
    insert_links()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cite" class="md-nav__link">
    cite()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list_cites" class="md-nav__link">
    list_cites()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/raindrum/citeurl/edit/main/docs_source/library.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="library-reference">Library Reference</h1>
<p>This page documents how to include CiteURL in your Python programming projects.</p>
<p>The first step is to instantiate a <a href="#citator">Citator</a>, which by default contains all of CiteURL's built-in <a href="#templates">Templates</a>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">citeurl</span> <span class="kn">import</span> <span class="n">Citator</span>
<span class="n">citator</span> <span class="o">=</span> <span class="n">Citator</span><span class="p">()</span>
</code></pre></div>
<p>After that, you can feed it text to return a list of <a href="#citation">Citations</a> it finds:</p>
<div class="highlight"><pre><span></span><code><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Federal law provides that courts should award prevailing civil rights plaintiffs reasonable attorneys fees, 42 USC § 1988(b), and, by discretion, expert fees, id. at (c). This is because the importance of civil rights litigation cannot be measured by a damages judgment. See Riverside v. Rivera, 477 U.S. 561 (1986). But Evans v. Jeff D. upheld a settlement where the plaintiffs got everything they wanted, on condition that they waive attorneys&#39; fees. 475 U.S. 717 (1986). This ruling lets savvy defendants create a wedge between plaintiffs and their attorneys, discouraging civil rights suits and undermining the court&#39;s logic in Riverside, 477 U.S. at 574-78.</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">citations</span> <span class="o">=</span> <span class="n">citator</span><span class="o">.</span><span class="n">list_cites</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
<p>Once you have a list of citations, you can get information about each one:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">citations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># 42 USC § 1988(b)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">citations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
<span class="c1"># {&#39;Title&#39;: &#39;42&#39;, &#39;Section&#39;: &#39;1988&#39;, &#39;subsection&#39;: &#39;(b)&#39;}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">citations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">URL</span><span class="p">)</span>
<span class="c1"># https://www.law.cornell.edu/uscode/text/42/1988#b</span>
</code></pre></div>
<p>You can also compare citations to one another, to determine whether they reference the same material or a subsection thereof:</p>
<div class="highlight"><pre><span></span><code><span class="n">art_I</span> <span class="o">=</span> <span class="n">citator</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="s1">&#39;U.S. Const. Art. I&#39;</span><span class="p">)</span>
<span class="n">also_art_I</span> <span class="o">=</span> <span class="n">citator</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="s1">&#39;Article I of the U.S. Constitution&#39;</span><span class="p">)</span>
<span class="n">art_I_sec_3</span> <span class="o">=</span> <span class="n">citator</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="s1">&#39;U.S. Const. Art. I, § 3&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">art_I</span> <span class="o">==</span> <span class="n">also_art_I</span>
<span class="k">assert</span> <span class="n">art_I_sec_3</span> <span class="ow">in</span> <span class="n">art_I</span>
</code></pre></div>
<p>Finally, if you don't want to bother with all the details, you can also just use <a href="#insert_links">insert_links()</a> to turn all the citations in a text into hyperlinks:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">citeurl</span> <span class="kn">import</span> <span class="n">insert_links</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;42 USC § 1988. &lt;i&gt;Id.&lt;/i&gt; at (b).&quot;</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">insert_links</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;&lt;a class=&quot;citation&quot; href=&quot;https://www.law.cornell.edu/uscode/text/42/1988&quot; title=&quot;42 U.S.C. § 1988&quot;&gt;42 USC § 1988&lt;/a&gt;. &lt;a class=&quot;citation&quot; href=&quot;https://www.law.cornell.edu/uscode/text/42/1988#b&quot; title=&quot;42 U.S.C. § 1988(b)&quot;&gt;&lt;i&gt;Id.&lt;/i&gt; at (b)&lt;/a&gt;.&#39;</span>
</code></pre></div>
<h2 id="citator">Citator</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>A collection of citation templates, and the tools to match text
against them en masse.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>templates</code></td>
        <td></td>
        <td><p>a dictionary of citation templates that this citator
will try to match against</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Citator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A collection of citation templates, and the tools to match text</span>
<span class="sd">    against them en masse.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        templates: a dictionary of citation templates that this citator</span>
<span class="sd">            will try to match against</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;caselaw&#39;</span><span class="p">,</span>
            <span class="s1">&#39;general federal law&#39;</span><span class="p">,</span>
            <span class="s1">&#39;specific federal laws&#39;</span><span class="p">,</span>
            <span class="s1">&#39;state law&#39;</span><span class="p">,</span>
            <span class="s1">&#39;secondary sources&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">yaml_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">templates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Template</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a citator from any combination of CiteURL&#39;s default</span>
<span class="sd">        template sets (by default, all of them), plus any custom</span>
<span class="sd">        templates you want, either by pointing to custom YAML files or</span>
<span class="sd">        making Template objects at runtime.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            defaults: names of files to load from the citeurl/templates</span>
<span class="sd">                folder. Each file contains one or more of CiteURL&#39;s</span>
<span class="sd">                built-in templates relevant to the given topic.</span>
<span class="sd">            yaml_paths: paths to custom YAML files to load templates</span>
<span class="sd">                from. These are loaded after the defaults, so they can</span>
<span class="sd">                inherit and/or overwrite them.</span>
<span class="sd">            templates: optional list of Template objects to load</span>
<span class="sd">                directly. These are loaded last, after the defaults and</span>
<span class="sd">                any yaml_paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">yamls_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;templates&#39;</span>    
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defaults</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">yaml_file</span> <span class="o">=</span> <span class="n">yamls_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.yaml&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">yaml_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">yaml_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">yaml</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a citator from scratch (i.e. without the default</span>
<span class="sd">        templates) by loading templates from the specified YAML string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">citator</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">citator</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">citator</span>

    <span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Save this citator to a YAML string to load later&quot;</span>
        <span class="n">yamls</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yamls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load templates from the given YAML, overwriting any existing</span>
<span class="sd">        templates with the same name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">safe_load</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Template</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">inheritables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the given text against each of the citator&#39;s templates and</span>
<span class="sd">        return the first citation detected, or None.</span>

<span class="sd">        If broad is true, matching is case-insensitive and each</span>
<span class="sd">        template&#39;s broad regexes are used in addition to its normal</span>
<span class="sd">        regexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">cite</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="n">broad</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cite</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cite</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">list_cites</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">id_breaks</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Citation</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all citations in the given text, whether longform,</span>
<span class="sd">        shortform, or idform. They will be listed in order of</span>
<span class="sd">        appearance. If any two citations overlap, the shorter one will</span>
<span class="sd">        be deleted. </span>

<span class="sd">        Wherever the id_breaks pattern matches, it will interrupt chains</span>
<span class="sd">        of idform citations. This is helpful </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first get a list of all long and shortform (not id.) citations</span>
        <span class="n">longforms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">longforms</span> <span class="o">+=</span> <span class="n">template</span><span class="o">.</span><span class="n">list_longform_cites</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">shortforms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">citation</span> <span class="ow">in</span> <span class="n">longforms</span><span class="p">:</span>
            <span class="n">shortforms</span> <span class="o">+=</span> <span class="n">citation</span><span class="o">.</span><span class="n">get_shortform_cites</span><span class="p">()</span>

        <span class="n">citations</span> <span class="o">=</span> <span class="n">longforms</span> <span class="o">+</span> <span class="n">shortforms</span>
        <span class="n">_sort_and_remove_overlaps</span><span class="p">(</span><span class="n">citations</span><span class="p">)</span>

        <span class="c1"># Figure out where to interrupt chains of idform citations,</span>
        <span class="c1"># i.e. anywhere a longform or shortform citation starts, plus</span>
        <span class="c1"># the start of any substring that matches the id_breaks pattern</span>
        <span class="n">breakpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">id_breaks</span><span class="p">:</span>
            <span class="n">breakpoints</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span>
                <span class="n">id_breaks</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="n">breakpoints</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">))</span>

        <span class="c1"># for each cite, look for idform citations until the next cite</span>
        <span class="c1"># or until the next breakpoint</span>
        <span class="n">idforms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cite</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">:</span>
            <span class="c1"># find the next relevant breakpoint, and delete any</span>
            <span class="c1"># breakpoints that are already behind the current citation</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">breakpoint</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">breakpoint</span> <span class="o">&gt;=</span> <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">breakpoints</span> <span class="o">=</span> <span class="n">breakpoints</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
                    <span class="k">break</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">breakpoint</span> <span class="o">=</span> <span class="n">breakpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">breakpoint</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># find the first idform reference to the citation, then the</span>
            <span class="c1"># first idform reference to that idform, and so on, until</span>
            <span class="c1"># the breakpoint</span>
            <span class="n">idform</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">get_idform_cite</span><span class="p">(</span><span class="n">until_index</span><span class="o">=</span><span class="n">breakpoint</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">idform</span><span class="p">:</span>
                <span class="n">idforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idform</span><span class="p">)</span>
                <span class="n">idform</span> <span class="o">=</span> <span class="n">idform</span><span class="o">.</span><span class="n">get_idform_cite</span><span class="p">(</span><span class="n">until_index</span><span class="o">=</span><span class="n">breakpoint</span><span class="p">)</span>

        <span class="n">citations</span> <span class="o">+=</span> <span class="n">idforms</span>
        <span class="n">_sort_and_remove_overlaps</span><span class="p">(</span><span class="n">citations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">citations</span>

    <span class="k">def</span> <span class="nf">insert_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;citation&#39;</span><span class="p">},</span>
        <span class="n">add_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">URL_optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">redundant_links</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">id_breaks</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_markup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan a text for citations, and return a text with each citation</span>
<span class="sd">        converted to a hyperlink.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            text: the string to scan for citations.</span>
<span class="sd">            attrs: various HTML link attributes to give to each link</span>
<span class="sd">            add_title: whether to use citation.name for link titles</span>
<span class="sd">            URL_optional: whether to insert a hyperlink even when the</span>
<span class="sd">                citation does not have an associated URL</span>
<span class="sd">            redundant_links: whether to insert a hyperlink if it would</span>
<span class="sd">                point to the same URL as the previous link</span>
<span class="sd">            id_breaks: wherever this regex appears, interrupt chains of</span>
<span class="sd">                &quot;Id.&quot;-type citations.</span>
<span class="sd">            ignore_markup: whether to preprocess and postprocess the</span>
<span class="sd">                text so that CiteURL can detect citations even when</span>
<span class="sd">                they contain inline markup, like &quot;&lt;i&gt;Id.&lt;/i&gt; at 32&quot;</span>

<span class="sd">        Returns:</span>
<span class="sd">            text, with an HTML `a` element for each citation. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># pull out all the inline HTML tags, e.g. &lt;b&gt;,</span>
        <span class="c1"># so they don&#39;t interfere with citation matching</span>
        <span class="k">if</span> <span class="n">ignore_markup</span><span class="p">:</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">stored_tags</span> <span class="o">=</span> <span class="n">_strip_inline_tags</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">cite_offsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">running_offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">last_URL</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">cite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_cites</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">id_breaks</span> <span class="o">=</span> <span class="n">id_breaks</span><span class="p">):</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">URL_optional</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">redundant_links</span> <span class="ow">and</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span> <span class="o">==</span> <span class="n">last_URL</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">add_title</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">name</span>

            <span class="n">attr_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span>
            <span class="p">])</span>
            <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;a</span><span class="si">{</span><span class="n">attr_str</span><span class="si">}</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&lt;/a&gt;&#39;</span>

            <span class="n">cite_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

            <span class="n">cite_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># beginning of citation</span>
                <span class="n">cite_offset</span><span class="p">,</span>
                <span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="p">))</span>

            <span class="n">span</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span><span class="p">,</span>
                <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span>
            <span class="p">)</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">link</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>

            <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">cite_offset</span>
            <span class="n">last_URL</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span>

        <span class="k">if</span> <span class="n">ignore_markup</span><span class="p">:</span>
            <span class="n">running_offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">stored_tags</span><span class="p">:</span>
                <span class="n">temp_offset</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">cite_offsets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># only offset by a cite if the tag</span>
                    <span class="c1"># is after the cite start</span>
                    <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cite_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">cite_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1"># check if the tag is after the cite end</span>
                        <span class="n">tag_start</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">cite_end</span> <span class="o">=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">tag_start</span> <span class="o">&gt;=</span> <span class="n">cite_end</span><span class="p">:</span>
                            <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">cite_offsets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c1"># otherwise, don&#39;t offset by the length of</span>
                        <span class="c1"># the cite&#39;s closing &lt;/a&gt; tag (length of 4)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp_offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="n">tag_pos</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span> <span class="o">+</span> <span class="n">temp_offset</span>

                <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">tag_pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">tag_pos</span><span class="p">:]</span>

                <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_citator</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">==</span> <span class="n">other_citator</span><span class="o">.</span><span class="n">templates</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;caselaw&#39;</span><span class="p">,</span> <span class="s1">&#39;general federal law&#39;</span><span class="p">,</span> <span class="s1">&#39;specific federal laws&#39;</span><span class="p">,</span> <span class="s1">&#39;state law&#39;</span><span class="p">,</span> <span class="s1">&#39;secondary sources&#39;</span><span class="p">],</span> <span class="n">yaml_paths</span><span class="o">=</span><span class="p">[],</span> <span class="n">templates</span><span class="o">=</span><span class="p">{})</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Create a citator from any combination of CiteURL's default
template sets (by default, all of them), plus any custom
templates you want, either by pointing to custom YAML files or
making Template objects at runtime.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>defaults</code></td>
        <td></td>
        <td><p>names of files to load from the citeurl/templates
folder. Each file contains one or more of CiteURL's
built-in templates relevant to the given topic.</p></td>
        <td><code>[&#39;caselaw&#39;, &#39;general federal law&#39;, &#39;specific federal laws&#39;, &#39;state law&#39;, &#39;secondary sources&#39;]</code></td>
      </tr>
      <tr>
        <td><code>yaml_paths</code></td>
        <td><code>list</code></td>
        <td><p>paths to custom YAML files to load templates
from. These are loaded after the defaults, so they can
inherit and/or overwrite them.</p></td>
        <td><code>[]</code></td>
      </tr>
      <tr>
        <td><code>templates</code></td>
        <td><code>dict</code></td>
        <td><p>optional list of Template objects to load
directly. These are loaded last, after the defaults and
any yaml_paths.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;caselaw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;general federal law&#39;</span><span class="p">,</span>
        <span class="s1">&#39;specific federal laws&#39;</span><span class="p">,</span>
        <span class="s1">&#39;state law&#39;</span><span class="p">,</span>
        <span class="s1">&#39;secondary sources&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">yaml_paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">templates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Template</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a citator from any combination of CiteURL&#39;s default</span>
<span class="sd">    template sets (by default, all of them), plus any custom</span>
<span class="sd">    templates you want, either by pointing to custom YAML files or</span>
<span class="sd">    making Template objects at runtime.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        defaults: names of files to load from the citeurl/templates</span>
<span class="sd">            folder. Each file contains one or more of CiteURL&#39;s</span>
<span class="sd">            built-in templates relevant to the given topic.</span>
<span class="sd">        yaml_paths: paths to custom YAML files to load templates</span>
<span class="sd">            from. These are loaded after the defaults, so they can</span>
<span class="sd">            inherit and/or overwrite them.</span>
<span class="sd">        templates: optional list of Template objects to load</span>
<span class="sd">            directly. These are loaded last, after the defaults and</span>
<span class="sd">            any yaml_paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">yamls_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;templates&#39;</span>    
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defaults</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="n">yaml_file</span> <span class="o">=</span> <span class="n">yamls_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.yaml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">yaml_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">yaml_paths</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.cite" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Check the given text against each of the citator's templates and
return the first citation detected, or None.</p>
<p>If broad is true, matching is case-insensitive and each
template's broad regexes are used in addition to its normal
regexes.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the given text against each of the citator&#39;s templates and</span>
<span class="sd">    return the first citation detected, or None.</span>

<span class="sd">    If broad is true, matching is case-insensitive and each</span>
<span class="sd">    template&#39;s broad regexes are used in addition to its normal</span>
<span class="sd">    regexes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">cite</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="n">broad</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cite</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cite</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.from_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_yaml</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Create a citator from scratch (i.e. without the default
templates) by loading templates from the specified YAML string.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">yaml</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a citator from scratch (i.e. without the default</span>
<span class="sd">    templates) by loading templates from the specified YAML string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citator</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">citator</span><span class="o">.</span><span class="n">load_yaml</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">citator</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.insert_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">insert_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;citation&#39;</span><span class="p">},</span> <span class="n">add_title</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">URL_optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">redundant_links</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">id_breaks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_markup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Scan a text for citations, and return a text with each citation
converted to a hyperlink.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>the string to scan for citations.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attrs</code></td>
        <td><code>dict</code></td>
        <td><p>various HTML link attributes to give to each link</p></td>
        <td><code>{&#39;class&#39;: &#39;citation&#39;}</code></td>
      </tr>
      <tr>
        <td><code>add_title</code></td>
        <td><code>bool</code></td>
        <td><p>whether to use citation.name for link titles</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>URL_optional</code></td>
        <td><code>bool</code></td>
        <td><p>whether to insert a hyperlink even when the
citation does not have an associated URL</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>redundant_links</code></td>
        <td><code>bool</code></td>
        <td><p>whether to insert a hyperlink if it would
point to the same URL as the previous link</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>id_breaks</code></td>
        <td><code>Pattern</code></td>
        <td><p>wherever this regex appears, interrupt chains of
"Id."-type citations.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>ignore_markup</code></td>
        <td><code>bool</code></td>
        <td><p>whether to preprocess and postprocess the
text so that CiteURL can detect citations even when
they contain inline markup, like "<i>Id.</i> at 32"</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>text, with an HTML <code>a</code> element for each citation. </p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">insert_links</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;citation&#39;</span><span class="p">},</span>
    <span class="n">add_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">URL_optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">redundant_links</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">id_breaks</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_markup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan a text for citations, and return a text with each citation</span>
<span class="sd">    converted to a hyperlink.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        text: the string to scan for citations.</span>
<span class="sd">        attrs: various HTML link attributes to give to each link</span>
<span class="sd">        add_title: whether to use citation.name for link titles</span>
<span class="sd">        URL_optional: whether to insert a hyperlink even when the</span>
<span class="sd">            citation does not have an associated URL</span>
<span class="sd">        redundant_links: whether to insert a hyperlink if it would</span>
<span class="sd">            point to the same URL as the previous link</span>
<span class="sd">        id_breaks: wherever this regex appears, interrupt chains of</span>
<span class="sd">            &quot;Id.&quot;-type citations.</span>
<span class="sd">        ignore_markup: whether to preprocess and postprocess the</span>
<span class="sd">            text so that CiteURL can detect citations even when</span>
<span class="sd">            they contain inline markup, like &quot;&lt;i&gt;Id.&lt;/i&gt; at 32&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">        text, with an HTML `a` element for each citation. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pull out all the inline HTML tags, e.g. &lt;b&gt;,</span>
    <span class="c1"># so they don&#39;t interfere with citation matching</span>
    <span class="k">if</span> <span class="n">ignore_markup</span><span class="p">:</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">stored_tags</span> <span class="o">=</span> <span class="n">_strip_inline_tags</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">cite_offsets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">running_offset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">last_URL</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">cite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_cites</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">id_breaks</span> <span class="o">=</span> <span class="n">id_breaks</span><span class="p">):</span>
        <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">URL_optional</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">redundant_links</span> <span class="ow">and</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span> <span class="o">==</span> <span class="n">last_URL</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">add_title</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">name</span>

        <span class="n">attr_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">=&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span>
        <span class="p">])</span>
        <span class="n">link</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;a</span><span class="si">{</span><span class="n">attr_str</span><span class="si">}</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&lt;/a&gt;&#39;</span>

        <span class="n">cite_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">link</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="n">cite_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
            <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># beginning of citation</span>
            <span class="n">cite_offset</span><span class="p">,</span>
            <span class="n">cite</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="p">))</span>

        <span class="n">span</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span><span class="p">,</span>
            <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span>
        <span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">link</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>

        <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">cite_offset</span>
        <span class="n">last_URL</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">URL</span>

    <span class="k">if</span> <span class="n">ignore_markup</span><span class="p">:</span>
        <span class="n">running_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">stored_tags</span><span class="p">:</span>
            <span class="n">temp_offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">cite_offsets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># only offset by a cite if the tag</span>
                <span class="c1"># is after the cite start</span>
                <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cite_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">cite_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># check if the tag is after the cite end</span>
                    <span class="n">tag_start</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cite_end</span> <span class="o">=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">tag_start</span> <span class="o">&gt;=</span> <span class="n">cite_end</span><span class="p">:</span>
                        <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">cite_offsets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># otherwise, don&#39;t offset by the length of</span>
                    <span class="c1"># the cite&#39;s closing &lt;/a&gt; tag (length of 4)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">temp_offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">tag_pos</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">running_offset</span> <span class="o">+</span> <span class="n">temp_offset</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">tag_pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">tag_pos</span><span class="p">:]</span>

            <span class="n">running_offset</span> <span class="o">+=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">text</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.list_cites" class="doc doc-heading">
<code class="highlight language-python"><span class="n">list_cites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">id_breaks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Find all citations in the given text, whether longform,
shortform, or idform. They will be listed in order of
appearance. If any two citations overlap, the shorter one will
be deleted. </p>
<p>Wherever the id_breaks pattern matches, it will interrupt chains
of idform citations. This is helpful </p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">list_cites</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">id_breaks</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Citation</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find all citations in the given text, whether longform,</span>
<span class="sd">    shortform, or idform. They will be listed in order of</span>
<span class="sd">    appearance. If any two citations overlap, the shorter one will</span>
<span class="sd">    be deleted. </span>

<span class="sd">    Wherever the id_breaks pattern matches, it will interrupt chains</span>
<span class="sd">    of idform citations. This is helpful </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># first get a list of all long and shortform (not id.) citations</span>
    <span class="n">longforms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">longforms</span> <span class="o">+=</span> <span class="n">template</span><span class="o">.</span><span class="n">list_longform_cites</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">shortforms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">citation</span> <span class="ow">in</span> <span class="n">longforms</span><span class="p">:</span>
        <span class="n">shortforms</span> <span class="o">+=</span> <span class="n">citation</span><span class="o">.</span><span class="n">get_shortform_cites</span><span class="p">()</span>

    <span class="n">citations</span> <span class="o">=</span> <span class="n">longforms</span> <span class="o">+</span> <span class="n">shortforms</span>
    <span class="n">_sort_and_remove_overlaps</span><span class="p">(</span><span class="n">citations</span><span class="p">)</span>

    <span class="c1"># Figure out where to interrupt chains of idform citations,</span>
    <span class="c1"># i.e. anywhere a longform or shortform citation starts, plus</span>
    <span class="c1"># the start of any substring that matches the id_breaks pattern</span>
    <span class="n">breakpoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">id_breaks</span><span class="p">:</span>
        <span class="n">breakpoints</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span>
            <span class="n">id_breaks</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="n">breakpoints</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">))</span>

    <span class="c1"># for each cite, look for idform citations until the next cite</span>
    <span class="c1"># or until the next breakpoint</span>
    <span class="n">idforms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cite</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">:</span>
        <span class="c1"># find the next relevant breakpoint, and delete any</span>
        <span class="c1"># breakpoints that are already behind the current citation</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">breakpoint</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">breakpoint</span> <span class="o">&gt;=</span> <span class="n">cite</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">breakpoints</span> <span class="o">=</span> <span class="n">breakpoints</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
                <span class="k">break</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">breakpoint</span> <span class="o">=</span> <span class="n">breakpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">breakpoint</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># find the first idform reference to the citation, then the</span>
        <span class="c1"># first idform reference to that idform, and so on, until</span>
        <span class="c1"># the breakpoint</span>
        <span class="n">idform</span> <span class="o">=</span> <span class="n">cite</span><span class="o">.</span><span class="n">get_idform_cite</span><span class="p">(</span><span class="n">until_index</span><span class="o">=</span><span class="n">breakpoint</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">idform</span><span class="p">:</span>
            <span class="n">idforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idform</span><span class="p">)</span>
            <span class="n">idform</span> <span class="o">=</span> <span class="n">idform</span><span class="o">.</span><span class="n">get_idform_cite</span><span class="p">(</span><span class="n">until_index</span><span class="o">=</span><span class="n">breakpoint</span><span class="p">)</span>

    <span class="n">citations</span> <span class="o">+=</span> <span class="n">idforms</span>
    <span class="n">_sort_and_remove_overlaps</span><span class="p">(</span><span class="n">citations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">citations</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.load_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Load templates from the given YAML, overwriting any existing
templates with the same name.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load templates from the given YAML, overwriting any existing</span>
<span class="sd">    templates with the same name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">safe_load</span><span class="p">(</span><span class="n">yaml</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Template</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">inheritables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Citator.to_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Save this citator to a YAML string to load later</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="s2">&quot;Save this citator to a YAML string to load later&quot;</span>
    <span class="n">yamls</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yamls</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="citation">Citation</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>A legal reference found in text.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>tokens</code></td>
        <td></td>
        <td><p>dictionary of the values that define this citation, such
as its volume and page number, or its title, section, and
subsection, etc</p></td>
      </tr>
      <tr>
        <td><code>URL</code></td>
        <td></td>
        <td><p>the location, if any, where this citation can be found
online, defined by the template's URL_builder</p></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td></td>
        <td><p>a uniform, human-readable representation of this citation,
written by the template's name_builder</p></td>
      </tr>
      <tr>
        <td><code>text</code></td>
        <td></td>
        <td><p>the actual text of this citation as found in the source
text</p></td>
      </tr>
      <tr>
        <td><code>source_text</code></td>
        <td></td>
        <td><p>the full text that this citation was found in</p></td>
      </tr>
      <tr>
        <td><code>template</code></td>
        <td></td>
        <td><p>the template whose regexes found this citation or its
parent</p></td>
      </tr>
      <tr>
        <td><code>parent</code></td>
        <td></td>
        <td><p>the earlier citation, if any, that this citation is a
shortform or idform child of</p></td>
      </tr>
      <tr>
        <td><code>raw_tokens</code></td>
        <td></td>
        <td><p>dictionary of tokens as captured in the original
regex match, before normalization. Note that for child
citations, raw_tokens will include any raw_tokens inferred
from the parent citation.</p></td>
      </tr>
      <tr>
        <td><code>idform_regexes</code></td>
        <td></td>
        <td><p>list of regex pattern objects to find child
citations later in the text, valid until the next different
citation appears.</p></td>
      </tr>
      <tr>
        <td><code>shortform_regexes</code></td>
        <td></td>
        <td><p>list of regex pattern objects to find
child citations anywhere in the subsequent text</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/citation.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Citation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A legal reference found in text.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        tokens: dictionary of the values that define this citation, such</span>
<span class="sd">            as its volume and page number, or its title, section, and</span>
<span class="sd">            subsection, etc</span>

<span class="sd">        URL: the location, if any, where this citation can be found</span>
<span class="sd">            online, defined by the template&#39;s URL_builder</span>

<span class="sd">        name: a uniform, human-readable representation of this citation,</span>
<span class="sd">            written by the template&#39;s name_builder</span>

<span class="sd">        text: the actual text of this citation as found in the source</span>
<span class="sd">            text</span>

<span class="sd">        source_text: the full text that this citation was found in</span>

<span class="sd">        template: the template whose regexes found this citation or its</span>
<span class="sd">            parent</span>

<span class="sd">        parent: the earlier citation, if any, that this citation is a</span>
<span class="sd">            shortform or idform child of</span>

<span class="sd">        raw_tokens: dictionary of tokens as captured in the original</span>
<span class="sd">            regex match, before normalization. Note that for child</span>
<span class="sd">            citations, raw_tokens will include any raw_tokens inferred</span>
<span class="sd">            from the parent citation.</span>

<span class="sd">        idform_regexes: list of regex pattern objects to find child</span>
<span class="sd">            citations later in the text, valid until the next different</span>
<span class="sd">            citation appears.</span>

<span class="sd">        shortform_regexes: list of regex pattern objects to find</span>
<span class="sd">            child citations anywhere in the subsequent text</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">match</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">,</span>
        <span class="n">template</span><span class="p">,</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">match</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>

        <span class="c1"># copy raw_tokens (in order) from the parent citation, but</span>
        <span class="c1"># stop at the first one that the child citation overwrites</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">merged_tokens</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">merged_tokens</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">merged_tokens</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">raw_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span> <span class="o">=</span> <span class="n">merged_tokens</span>

        <span class="c1"># normalize raw_tokens to get consistent token values across</span>
        <span class="c1"># differently-formatted citations to the same source.</span>
        <span class="c1"># This will raise a SyntaxError if a mandatory edit fails</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttype</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c1"># Finally, compile the citation&#39;s idform and shortform regexes.</span>
        <span class="c1"># To avoid unneccessary work, first try to copy regexes from the</span>
        <span class="c1"># parent citation if applicable.</span>

        <span class="k">if</span> <span class="n">parent</span> <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">raw_tokens</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span><span class="p">:</span>
        <span class="c1"># then we can safely copy the parent&#39;s regexes to the child</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">idform_regexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shortform_regexes</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">shortform_regexes</span>
            <span class="k">return</span>

        <span class="c1"># otherwise we&#39;ll need to compile new shortform regexes,</span>
        <span class="c1"># but we can still copy some of them from the parent</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;replacements&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_tokens</span><span class="p">,</span>
            <span class="s1">&#39;token_prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;same&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="c1"># we can copy regexes, but only if they do not reference a</span>
        <span class="c1"># specific value from the citation, e.g. {same volume}.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shortform_regexes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">process_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;{same &#39;</span> <span class="ow">in</span> <span class="n">pattern</span> <span class="k">else</span> <span class="n">parent</span><span class="o">.</span><span class="n">shortform_regexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">_processed_shortforms</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">process_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;{same &#39;</span> <span class="ow">in</span> <span class="n">pattern</span> <span class="k">else</span> <span class="n">parent</span><span class="o">.</span><span class="n">idform_regexes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">_processed_idforms</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># compile all-new idforms and shortforms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shortform_regexes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">process_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">_processed_shortforms</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">process_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">_processed_idforms</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BASIC_ID_REGEX</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">URL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;%20&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name_builder</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name_builder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_shortform_cites</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
        <span class="n">keep_trying</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">span_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">keep_trying</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">match_regexes</span><span class="p">(</span>
                    <span class="n">regexes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shortform_regexes</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source_text</span><span class="p">,</span>
                    <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="n">span_start</span><span class="p">,),</span>
                <span class="p">))</span>
                <span class="n">span_start</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">Citation</span><span class="p">(</span>
                        <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span>
                        <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span> <span class="c1"># it&#39;s an invalid citation</span>
                    <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="n">keep_trying</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_idform_cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">until_index</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">match_regexes</span><span class="p">(</span>
                <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span><span class="p">,</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_text</span><span class="p">,</span>
                <span class="n">span</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">until_index</span><span class="p">)</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_next_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">match_regexes</span><span class="p">(</span>
                <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortform_regexes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">idform_regexes</span><span class="p">,</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_text</span><span class="p">,</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="k">if</span> <span class="n">span</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">),</span>
            <span class="p">))</span>
            <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Citation(match=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="si">}</span><span class="s1">, template=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, parent=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if both citations are from templates with the same</span>
<span class="sd">        name, and the only difference between their tokens is that the</span>
<span class="sd">        other one has a more specific (i.e. higher-indexed) token than</span>
<span class="sd">        any of this one&#39;s. Severable tokens are considered a match if</span>
<span class="sd">        the other token&#39;s value *starts with* this one&#39;s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">other_cite</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span>
            <span class="ow">or</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">severable</span>
                    <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if both citations are from templates with the same</span>
<span class="sd">        name, and they have the exact same token values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">other_cite</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span>
            <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h3 id="citeurl.citation.Citation.__contains__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Returns True if both citations are from templates with the same
name, and the only difference between their tokens is that the
other one has a more specific (i.e. higher-indexed) token than
any of this one's. Severable tokens are considered a match if
the other token's value <em>starts with</em> this one's.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citation.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if both citations are from templates with the same</span>
<span class="sd">    name, and the only difference between their tokens is that the</span>
<span class="sd">    other one has a more specific (i.e. higher-indexed) token than</span>
<span class="sd">    any of this one&#39;s. Severable tokens are considered a match if</span>
<span class="sd">    the other token&#39;s value *starts with* this one&#39;s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">other_cite</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span>
        <span class="ow">or</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">severable</span>
                <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citation.Citation.__eq__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Returns True if both citations are from templates with the same
name, and they have the exact same token values.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citation.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_cite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns True if both citations are from templates with the same</span>
<span class="sd">    name, and they have the exact same token values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">other_cite</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span>
        <span class="ow">and</span> <span class="n">other_cite</span><span class="o">.</span><span class="n">tokens</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>












  </div>

    </div>

  </div>

<h2 id="template">Template</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>A pattern to recognize a single kind of citation and extract
information from it.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Template</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pattern to recognize a single kind of citation and extract</span>
<span class="sd">    information from it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">tokens</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">broad_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">shortform_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">idform_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">name_builder</span><span class="p">:</span> <span class="n">StringBuilder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">URL_builder</span><span class="p">:</span> <span class="n">StringBuilder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inherit_template</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">            name: the name of this template</span>

<span class="sd">            tokens: The full dictionary of TokenTypes that citations from</span>
<span class="sd">                this template can contain. These must be listed in order</span>
<span class="sd">                from least-specific to most. For instance, the U.S.</span>
<span class="sd">                Constitution&#39;s template puts &#39;article&#39; before &#39;section&#39;</span>
<span class="sd">                before &#39;clause&#39;, because articles contain sections, and</span>
<span class="sd">                sections contain clauses.</span>

<span class="sd">            patterns: Patterns are essentially regexes to recognize</span>
<span class="sd">                recognize long-form citations to this template. However,</span>
<span class="sd">                wherever a token would appear in the regex, it should be</span>
<span class="sd">                replaced by the name of the token, enclosed in curly</span>
<span class="sd">                braces.</span>

<span class="sd">                Patterns are matched in the order that they are listed,</span>
<span class="sd">                so if there is a pattern that can only find a subset of</span>
<span class="sd">                tokens, it should be listed after the more-complete</span>
<span class="sd">                pattern so that the better match won&#39;t be precluded.</span>

<span class="sd">            broad_patterns: Same as `patterns`, except that they will</span>
<span class="sd">                only be used in contexts like search engines, where</span>
<span class="sd">                convenience is more important than avoiding false</span>
<span class="sd">                positive matches. When used, they will be used in</span>
<span class="sd">                addition to the normal patterns.</span>

<span class="sd">            shortform_patterns: Same as `patterns`, but these will only</span>
<span class="sd">                go into effect after a longform citation has been</span>
<span class="sd">                recognized. If a shortform pattern includes &quot;same</span>
<span class="sd">                TOKEN_NAME&quot; in curly braces, e.g. &quot;{same volume}&quot;, the</span>
<span class="sd">                bracketed portion will be replaced with the exact text</span>
<span class="sd">                of the corresponding `raw_token` from the long-form</span>
<span class="sd">                citation.</span>

<span class="sd">            idform_patterns: Same as `shortform_patterns`, except that</span>
<span class="sd">                they will only be used to scan text until the next</span>
<span class="sd">                different citation occurs.</span>

<span class="sd">            URL_builder: `StringBuilder` to construct URLs for found</span>
<span class="sd">                citations</span>

<span class="sd">            name_builder: `StringBuilder` to construct canonical names</span>
<span class="sd">                of found citations</span>

<span class="sd">            meta: Optional metadata relating to this template. Patterns</span>
<span class="sd">                and StringBuilders can access metadata fields as if they</span>
<span class="sd">                were tokens, though fields can be overridden by tokens</span>
<span class="sd">                with the same name.</span>

<span class="sd">            inherit_template: another `Template` whose values this one</span>
<span class="sd">                should copy unless expressly overwritten.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span>               <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;tokens&#39;</span><span class="p">:</span>             <span class="p">{},</span>
            <span class="s1">&#39;patterns&#39;</span><span class="p">:</span>           <span class="p">[],</span>
            <span class="s1">&#39;broad_patterns&#39;</span><span class="p">:</span>     <span class="p">[],</span>
            <span class="s1">&#39;shortform_patterns&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;idform_patterns&#39;</span><span class="p">:</span>    <span class="p">[],</span>
            <span class="s1">&#39;URL_builder&#39;</span><span class="p">:</span>        <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;name_builder&#39;</span><span class="p">:</span>       <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;meta&#39;</span><span class="p">:</span>               <span class="p">{},</span>
        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">inherit_template</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">inherit_template</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;patterns&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># update inherited StringBuilders with the correct metadata</span>
        <span class="k">if</span> <span class="n">inherit_template</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>

        <span class="c1"># use the template&#39;s metadata and tokens to make a dictionary</span>
        <span class="c1"># of replacements to insert into the regexes before compilation</span>
        <span class="n">replacements</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">replacements</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="n">k</span><span class="p">:</span><span class="sa">fr</span><span class="s1">&#39;(?P&lt;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">regex</span><span class="si">}</span><span class="s1">)(?!\w)&#39;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1"># compile the template&#39;s regexes and broad_regexes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;regexes&#39;</span><span class="p">,</span> <span class="s1">&#39;broad_regexes&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;broad_regexes&#39;</span><span class="p">:</span>
                <span class="n">pattern_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_patterns</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pattern_list</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">process_pattern</span><span class="p">(</span>
                    <span class="n">p</span><span class="p">,</span>
                    <span class="n">replacements</span><span class="p">,</span>
                    <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;broad &#39;</span> <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;broad_regexes&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">raise</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1"> template</span><span class="se">\&#39;</span><span class="s1">s </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">pattern &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s1">&quot; has &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_shortforms</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">process_pattern</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortform_patterns</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_idforms</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">process_pattern</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idform_patterns</span>
        <span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inheritables</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a template from a dictionary of values, like a dictionary</span>
<span class="sd">        created by parsing a template from YAML format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">):</span><span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># when pattern is listed in singular form,</span>
        <span class="c1"># replace it with a one-item list</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">):</span>
                <span class="n">values</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># unrelated: when a single pattern is split</span>
        <span class="c1"># into a list (likely to take advantage of</span>
        <span class="c1"># YAML anchors), join it into one string</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;patterns&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

        <span class="n">inherit</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inherit&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inherit</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inherit&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s1">&#39;inherit_template&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inheritables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inherit</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Template &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; tried to inherit unknown &#39;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;template &quot;</span><span class="si">{</span><span class="n">inherit</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name_builder&#39;</span><span class="p">,</span> <span class="s1">&#39;URL_builder&#39;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
                <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">StringBuilder</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s2">&quot;save this Template to a dictionary of values&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;shortform_patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;idform_patterns&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># de-pluralize lists that contain only one pattern</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name_builder&#39;</span><span class="p">,</span> <span class="s1">&#39;URL_builder&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="n">spaced_output</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">spaced_output</span>

    <span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s2">&quot;save this Template to a YAML string&quot;</span>
        <span class="k">return</span> <span class="n">safe_dump</span><span class="p">(</span>
            <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()},</span>
            <span class="n">sort_keys</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">allow_unicode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first citation that matches this template. If &#39;broad&#39;</span>
<span class="sd">        is True, case-insensitive matching and broad regex patterns will</span>
<span class="sd">        be used. If no matches are found, return None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="k">if</span> <span class="n">broad</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">match_regexes</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regexes</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span> <span class="c1"># invalid citation</span>
                <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">list_longform_cites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of all long-form citations to this template found in</span>
<span class="sd">        the given text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="k">if</span> <span class="n">broad</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_regexes</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regexes</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">return</span> <span class="n">cites</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Template(name=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, tokens=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, meta=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, patterns=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;, broad_patterns=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">broad_patterns</span><span class="si">}</span><span class="s1">&#39;</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_patterns</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;, shortform_patterns=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shortform_patterns</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortform_patterns</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;, idform_patterns=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">idform_patterns</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idform_patterns</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;, name_builder=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;, URL_builder=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">citation</span><span class="p">:</span> <span class="n">Citation</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">citation</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_template</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">repr</span><span class="p">(</span><span class="n">other_template</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tokens</span><span class="o">=</span><span class="p">{},</span> <span class="n">meta</span><span class="o">=</span><span class="p">{},</span> <span class="n">patterns</span><span class="o">=</span><span class="p">[],</span> <span class="n">broad_patterns</span><span class="o">=</span><span class="p">[],</span> <span class="n">shortform_patterns</span><span class="o">=</span><span class="p">[],</span> <span class="n">idform_patterns</span><span class="o">=</span><span class="p">[],</span> <span class="n">name_builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">URL_builder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inherit_template</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>the name of this template</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>tokens</code></td>
        <td><code>dict</code></td>
        <td><p>The full dictionary of TokenTypes that citations from
this template can contain. These must be listed in order
from least-specific to most. For instance, the U.S.
Constitution's template puts 'article' before 'section'
before 'clause', because articles contain sections, and
sections contain clauses.</p></td>
        <td><code>{}</code></td>
      </tr>
      <tr>
        <td><code>patterns</code></td>
        <td><code>list</code></td>
        <td><p>Patterns are essentially regexes to recognize
recognize long-form citations to this template. However,
wherever a token would appear in the regex, it should be
replaced by the name of the token, enclosed in curly
braces.</p>
<p>Patterns are matched in the order that they are listed,
so if there is a pattern that can only find a subset of
tokens, it should be listed after the more-complete
pattern so that the better match won't be precluded.</p></td>
        <td><code>[]</code></td>
      </tr>
      <tr>
        <td><code>broad_patterns</code></td>
        <td><code>list</code></td>
        <td><p>Same as <code>patterns</code>, except that they will
only be used in contexts like search engines, where
convenience is more important than avoiding false
positive matches. When used, they will be used in
addition to the normal patterns.</p></td>
        <td><code>[]</code></td>
      </tr>
      <tr>
        <td><code>shortform_patterns</code></td>
        <td><code>list</code></td>
        <td><p>Same as <code>patterns</code>, but these will only
go into effect after a longform citation has been
recognized. If a shortform pattern includes "same
TOKEN_NAME" in curly braces, e.g. "{same volume}", the
bracketed portion will be replaced with the exact text
of the corresponding <code>raw_token</code> from the long-form
citation.</p></td>
        <td><code>[]</code></td>
      </tr>
      <tr>
        <td><code>idform_patterns</code></td>
        <td><code>list</code></td>
        <td><p>Same as <code>shortform_patterns</code>, except that
they will only be used to scan text until the next
different citation occurs.</p></td>
        <td><code>[]</code></td>
      </tr>
      <tr>
        <td><code>URL_builder</code></td>
        <td><code>StringBuilder</code></td>
        <td><p><code>StringBuilder</code> to construct URLs for found
citations</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>name_builder</code></td>
        <td><code>StringBuilder</code></td>
        <td><p><code>StringBuilder</code> to construct canonical names
of found citations</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>meta</code></td>
        <td><code>dict</code></td>
        <td><p>Optional metadata relating to this template. Patterns
and StringBuilders can access metadata fields as if they
were tokens, though fields can be overridden by tokens
with the same name.</p></td>
        <td><code>{}</code></td>
      </tr>
      <tr>
        <td><code>inherit_template</code></td>
        <td></td>
        <td><p>another <code>Template</code> whose values this one
should copy unless expressly overwritten.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">tokens</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TokenType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">broad_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">shortform_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">idform_patterns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">name_builder</span><span class="p">:</span> <span class="n">StringBuilder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">URL_builder</span><span class="p">:</span> <span class="n">StringBuilder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">inherit_template</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments:</span>
<span class="sd">        name: the name of this template</span>

<span class="sd">        tokens: The full dictionary of TokenTypes that citations from</span>
<span class="sd">            this template can contain. These must be listed in order</span>
<span class="sd">            from least-specific to most. For instance, the U.S.</span>
<span class="sd">            Constitution&#39;s template puts &#39;article&#39; before &#39;section&#39;</span>
<span class="sd">            before &#39;clause&#39;, because articles contain sections, and</span>
<span class="sd">            sections contain clauses.</span>

<span class="sd">        patterns: Patterns are essentially regexes to recognize</span>
<span class="sd">            recognize long-form citations to this template. However,</span>
<span class="sd">            wherever a token would appear in the regex, it should be</span>
<span class="sd">            replaced by the name of the token, enclosed in curly</span>
<span class="sd">            braces.</span>

<span class="sd">            Patterns are matched in the order that they are listed,</span>
<span class="sd">            so if there is a pattern that can only find a subset of</span>
<span class="sd">            tokens, it should be listed after the more-complete</span>
<span class="sd">            pattern so that the better match won&#39;t be precluded.</span>

<span class="sd">        broad_patterns: Same as `patterns`, except that they will</span>
<span class="sd">            only be used in contexts like search engines, where</span>
<span class="sd">            convenience is more important than avoiding false</span>
<span class="sd">            positive matches. When used, they will be used in</span>
<span class="sd">            addition to the normal patterns.</span>

<span class="sd">        shortform_patterns: Same as `patterns`, but these will only</span>
<span class="sd">            go into effect after a longform citation has been</span>
<span class="sd">            recognized. If a shortform pattern includes &quot;same</span>
<span class="sd">            TOKEN_NAME&quot; in curly braces, e.g. &quot;{same volume}&quot;, the</span>
<span class="sd">            bracketed portion will be replaced with the exact text</span>
<span class="sd">            of the corresponding `raw_token` from the long-form</span>
<span class="sd">            citation.</span>

<span class="sd">        idform_patterns: Same as `shortform_patterns`, except that</span>
<span class="sd">            they will only be used to scan text until the next</span>
<span class="sd">            different citation occurs.</span>

<span class="sd">        URL_builder: `StringBuilder` to construct URLs for found</span>
<span class="sd">            citations</span>

<span class="sd">        name_builder: `StringBuilder` to construct canonical names</span>
<span class="sd">            of found citations</span>

<span class="sd">        meta: Optional metadata relating to this template. Patterns</span>
<span class="sd">            and StringBuilders can access metadata fields as if they</span>
<span class="sd">            were tokens, though fields can be overridden by tokens</span>
<span class="sd">            with the same name.</span>

<span class="sd">        inherit_template: another `Template` whose values this one</span>
<span class="sd">            should copy unless expressly overwritten.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span>               <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;tokens&#39;</span><span class="p">:</span>             <span class="p">{},</span>
        <span class="s1">&#39;patterns&#39;</span><span class="p">:</span>           <span class="p">[],</span>
        <span class="s1">&#39;broad_patterns&#39;</span><span class="p">:</span>     <span class="p">[],</span>
        <span class="s1">&#39;shortform_patterns&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;idform_patterns&#39;</span><span class="p">:</span>    <span class="p">[],</span>
        <span class="s1">&#39;URL_builder&#39;</span><span class="p">:</span>        <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;name_builder&#39;</span><span class="p">:</span>       <span class="kc">None</span><span class="p">,</span>
        <span class="s1">&#39;meta&#39;</span><span class="p">:</span>               <span class="p">{},</span>
    <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">inherit_template</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">==</span> <span class="n">default</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">inherit_template</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;patterns&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># update inherited StringBuilders with the correct metadata</span>
    <span class="k">if</span> <span class="n">inherit_template</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URL_builder</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_builder</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>

    <span class="c1"># use the template&#39;s metadata and tokens to make a dictionary</span>
    <span class="c1"># of replacements to insert into the regexes before compilation</span>
    <span class="n">replacements</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">replacements</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="n">k</span><span class="p">:</span><span class="sa">fr</span><span class="s1">&#39;(?P&lt;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">regex</span><span class="si">}</span><span class="s1">)(?!\w)&#39;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="c1"># compile the template&#39;s regexes and broad_regexes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">kind</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;regexes&#39;</span><span class="p">,</span> <span class="s1">&#39;broad_regexes&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;broad_regexes&#39;</span><span class="p">:</span>
            <span class="n">pattern_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_patterns</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pattern_list</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">process_pattern</span><span class="p">(</span>
                <span class="n">p</span><span class="p">,</span>
                <span class="n">replacements</span><span class="p">,</span>
                <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;broad &#39;</span> <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;broad_regexes&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="k">raise</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1"> template</span><span class="se">\&#39;</span><span class="s1">s </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">pattern &quot;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s1">&quot; has &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;an error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_processed_shortforms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">process_pattern</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortform_patterns</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_processed_idforms</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">process_pattern</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="n">add_word_breaks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idform_patterns</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.cite" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Return the first citation that matches this template. If 'broad'
is True, case-insensitive matching and broad regex patterns will
be used. If no matches are found, return None.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the first citation that matches this template. If &#39;broad&#39;</span>
<span class="sd">    is True, case-insensitive matching and broad regex patterns will</span>
<span class="sd">    be used. If no matches are found, return None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="k">if</span> <span class="n">broad</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">match_regexes</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regexes</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span> <span class="c1"># invalid citation</span>
            <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">inheritables</span><span class="o">=</span><span class="p">{})</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Return a template from a dictionary of values, like a dictionary
created by parsing a template from YAML format.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">inheritables</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a template from a dictionary of values, like a dictionary</span>
<span class="sd">    created by parsing a template from YAML format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">):</span><span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># when pattern is listed in singular form,</span>
    <span class="c1"># replace it with a one-item list</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;pattern&#39;</span><span class="p">):</span>
            <span class="n">values</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># unrelated: when a single pattern is split</span>
    <span class="c1"># into a list (likely to take advantage of</span>
    <span class="c1"># YAML anchors), join it into one string</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;patterns&#39;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

    <span class="n">inherit</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inherit&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inherit</span><span class="p">:</span>
        <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inherit&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s1">&#39;inherit_template&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inheritables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inherit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Template &quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot; tried to inherit unknown &#39;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;template &quot;</span><span class="si">{</span><span class="n">inherit</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name_builder&#39;</span><span class="p">,</span> <span class="s1">&#39;URL_builder&#39;</span><span class="p">]:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;defaults&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meta&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">StringBuilder</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">TokenType</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tokens&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.list_longform_cites" class="doc doc-heading">
<code class="highlight language-python"><span class="n">list_longform_cites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>Get a list of all long-form citations to this template found in
the given text.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">list_longform_cites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a list of all long-form citations to this template found in</span>
<span class="sd">    the given text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">regexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">broad_regexes</span> <span class="k">if</span> <span class="n">broad</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">regexes</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">match_regexes</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">regexes</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Citation</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">return</span> <span class="n">cites</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.to_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save this Template to a dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s2">&quot;save this Template to a dictionary of values&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;tokens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;shortform_patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;idform_patterns&#39;</span><span class="p">]:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># de-pluralize lists that contain only one pattern</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name_builder&#39;</span><span class="p">,</span> <span class="s1">&#39;URL_builder&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="n">spaced_output</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">return</span> <span class="n">spaced_output</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.citator.Template.to_yaml" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save this Template to a YAML string</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;save this Template to a YAML string&quot;</span>
    <span class="k">return</span> <span class="n">safe_dump</span><span class="p">(</span>
        <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()},</span>
        <span class="n">sort_keys</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">allow_unicode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="tokentype">TokenType</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>These objects represent categories of tokens that might be found in
a citation.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>regex</code></td>
        <td></td>
        <td><p>A regular expression that matches the actual text of the
token as found in any document, like the "42" in "42 USC §
1983" or the "Fourteenth" in "The Fourteenth Amendment".
This regex will automatically be enclosed in a named capture
group and inserted into any of the template's match patterns
wherever the token's name appears in curly braces.</p></td>
      </tr>
      <tr>
        <td><code>edits</code></td>
        <td></td>
        <td><p>Steps to normalize the token as captured in the regex
into a value that is consistent across multiple styles.</p></td>
      </tr>
      <tr>
        <td><code>default</code></td>
        <td></td>
        <td><p>Set the token to this value if it is not found in the
citation.</p></td>
      </tr>
      <tr>
        <td><code>severable</code></td>
        <td></td>
        <td><p>If two citations only differ based on this token,
and only because one of the tokens extends longer than the
other, e.g. "(b)(2)" and "(b)(2)(A)", then <code>severable</code> means
that the former citation is thought to encompass the latter.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TokenType</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    These objects represent categories of tokens that might be found in</span>
<span class="sd">    a citation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        regex: A regular expression that matches the actual text of the</span>
<span class="sd">            token as found in any document, like the &quot;42&quot; in &quot;42 USC §</span>
<span class="sd">            1983&quot; or the &quot;Fourteenth&quot; in &quot;The Fourteenth Amendment&quot;.</span>
<span class="sd">            This regex will automatically be enclosed in a named capture</span>
<span class="sd">            group and inserted into any of the template&#39;s match patterns</span>
<span class="sd">            wherever the token&#39;s name appears in curly braces.</span>
<span class="sd">        edits: Steps to normalize the token as captured in the regex</span>
<span class="sd">            into a value that is consistent across multiple styles.</span>
<span class="sd">        default: Set the token to this value if it is not found in the</span>
<span class="sd">            citation.</span>
<span class="sd">        severable: If two citations only differ based on this token,</span>
<span class="sd">            and only because one of the tokens extends longer than the</span>
<span class="sd">            other, e.g. &quot;(b)(2)&quot; and &quot;(b)(2)(A)&quot;, then `severable` means</span>
<span class="sd">            that the former citation is thought to encompass the latter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span>
        <span class="n">edits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TokenOperation</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">default</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">severable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edits</span> <span class="o">=</span> <span class="n">edits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">severable</span> <span class="o">=</span> <span class="n">severable</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="s2">&quot;load a TokenType from a dictionary of values&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regex&#39;</span><span class="p">],</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">),</span>
            <span class="n">edits</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">TokenOperation</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edits&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="p">],</span>
            <span class="n">severable</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severable&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s2">&quot;save this TokenType to a dictionary for storage in YAML format&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;edits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">e</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">severable</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;severable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">token</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">norms</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="nb">repr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TokenType(regex=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;, default=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, edits=</span><span class="si">{</span><span class="n">norms</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenType.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>load a TokenType from a dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="s2">&quot;load a TokenType from a dictionary of values&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">regex</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;regex&#39;</span><span class="p">],</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">),</span>
        <span class="n">edits</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TokenOperation</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edits&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">],</span>
        <span class="n">severable</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severable&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenType.to_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save this TokenType to a dictionary for storage in YAML format</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s2">&quot;save this TokenType to a dictionary for storage in YAML format&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;edits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">e</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">severable</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;severable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="tokenoperation">TokenOperation</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>A function to perform a predefined string manipulation</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TokenOperation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A function to perform a predefined string manipulation&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">mandatory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">            action: The kind of string manipulation that this operation</span>
<span class="sd">                will perform, using the given data. There are a few</span>
<span class="sd">                different options:</span>

<span class="sd">                &#39;sub&#39;: Regex substitution to perform on the text. Needs</span>
<span class="sd">                    a list of two values: [PATTERN, REPLACEMENT]</span>

<span class="sd">                &#39;lookup&#39;: Check if the token matches any of the given</span>
<span class="sd">                    regexes (via case-insensitive matching), and if so,</span>
<span class="sd">                    replace it with the corresponding value. Needs a</span>
<span class="sd">                    dictionary of `regex`: `replacement` pairs.</span>

<span class="sd">                &#39;case&#39;: Capitalize the token in the specified way.</span>
<span class="sd">                    Options are &#39;upper&#39;, &#39;lower&#39;, and &#39;title&#39;.</span>

<span class="sd">                &#39;lpad&#39;: Left pad the token with zeros until it is the</span>
<span class="sd">                    specified number of characters long. Requires an</span>
<span class="sd">                    int specifying the number of characters. You can</span>
<span class="sd">                    also specify the padding character by providing a</span>
<span class="sd">                    tuple: (MINIMUM_LENGTH, PADDING_CHARACTER).</span>

<span class="sd">                &#39;number_style&#39;: Assume that the token is a number,</span>
<span class="sd">                    either in the form of digits, Roman numerals, or</span>
<span class="sd">                    number words like &quot;thirty-seven&quot;. Convert it into</span>
<span class="sd">                    the specified number format, which can be any of</span>
<span class="sd">                    these:</span>

<span class="sd">                    &#39;cardinal&#39;, e.g. &quot;twenty-seven&quot;</span>

<span class="sd">                    &#39;cardinal spaced&#39;, e.g. &quot;twenty seven&quot;</span>

<span class="sd">                    &#39;cardinal unspaced&#39;, e.g. &quot;twentyseven&quot;</span>

<span class="sd">                    &#39;ordinal&#39;, e.g. &quot;twenty-seventh&quot;</span>

<span class="sd">                    &#39;ordinal spaced&#39;, e.g. &quot;twenty seventh&quot;</span>

<span class="sd">                    &#39;ordinal unspaced&#39;, e.g. &quot;twentyseventh&quot;</span>

<span class="sd">                    &#39;roman numeral&#39;, e.g. &#39;xxvii&#39;</span>

<span class="sd">                    &#39;digit&#39;, e.g. &#39;27&#39;</span>

<span class="sd">                    Note that number formatting only works for positive</span>
<span class="sd">                    whole numbers that do not exceed 40.</span>

<span class="sd">            data: any data that a given action needs specified, as</span>
<span class="sd">                described above</span>

<span class="sd">            mandatory: whether a failed lookup or format action should</span>
<span class="sd">                invalidate the entire citation</span>

<span class="sd">            token: Necessary for operations in StringBuilders. This</span>
<span class="sd">                value lets you provide the name of input token to use,</span>
<span class="sd">                allowing you to then use the modify_dict() method.</span>

<span class="sd">            output: If this value is set, modify_dict() will save the</span>
<span class="sd">                operation&#39;s output to the dictionary key with this name</span>
<span class="sd">                instead of modifying the input token in place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;sub&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;lookup&#39;</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span><span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;case&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_case</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;lpad&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_pad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;number_style&#39;</span><span class="p">:</span>
            <span class="n">action_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cardinal&#39;</span><span class="p">,</span> <span class="s1">&#39;ordinal&#39;</span><span class="p">,</span> <span class="s1">&#39;roman&#39;</span><span class="p">,</span> <span class="s1">&#39;digit&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1"> is not a valid number style. Valid options: &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">action_options</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_style</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1"> is not a defined token operation.&#39;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mandatory</span> <span class="o">=</span> <span class="n">mandatory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="s2">&quot;load a TokenOperation from a dictionary of values&quot;</span>
        <span class="n">operations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="s1">&#39;lookup&#39;</span><span class="p">,</span> <span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="s1">&#39;lpad&#39;</span><span class="p">,</span> <span class="s1">&#39;number style&#39;</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">action_data</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">break</span>
        <span class="n">mandatory</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mandatory&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_data</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s2">&quot;save this TokenOperation to a dictionary of values&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">output</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mandatory</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;mandatory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">spaced_output</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">spaced_output</span>

    <span class="k">def</span> <span class="nf">modify_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        apply this operation to a dictionary of tokens,</span>
<span class="sd">        editing them as appropriate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">input_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;TokenOperation(action=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s1">&quot;, data=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, mandatory=False&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mandatory</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, token=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, output=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="p">)</span>

    <span class="c1"># ================ Token Processing Operations =================== #</span>

    <span class="k">def</span> <span class="nf">_lookup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">mandatory</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">repl</span>
        <span class="k">if</span> <span class="n">mandatory</span><span class="p">:</span>
            <span class="n">regexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">pattern</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1"> could not be found in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">input</span>

    <span class="k">def</span> <span class="nf">_set_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_left_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pad_char</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">min_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pad_char</span><span class="o">*</span><span class="n">diff</span> <span class="o">+</span> <span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span>

    <span class="k">def</span> <span class="nf">_number_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">form</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">throw_error</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">input</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span> <span class="c1"># e.g. &quot;2nd&quot;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_words</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">throw_error</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s1"> cannot be recognized as a number&#39;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span> <span class="o">==</span> <span class="s1">&#39;digit&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">forms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;roman&#39;</span><span class="p">,</span> <span class="s1">&#39;cardinal&#39;</span><span class="p">,</span> <span class="s1">&#39;ordinal&#39;</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">number_words</span><span class="p">[</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">forms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">form</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">form</span> <span class="o">==</span> <span class="s1">&#39;roman&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenOperation.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mandatory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>action</code></td>
        <td><code>str</code></td>
        <td><p>The kind of string manipulation that this operation
will perform, using the given data. There are a few
different options:</p>
<p>'sub': Regex substitution to perform on the text. Needs
    a list of two values: [PATTERN, REPLACEMENT]</p>
<p>'lookup': Check if the token matches any of the given
    regexes (via case-insensitive matching), and if so,
    replace it with the corresponding value. Needs a
    dictionary of <code>regex</code>: <code>replacement</code> pairs.</p>
<p>'case': Capitalize the token in the specified way.
    Options are 'upper', 'lower', and 'title'.</p>
<p>'lpad': Left pad the token with zeros until it is the
    specified number of characters long. Requires an
    int specifying the number of characters. You can
    also specify the padding character by providing a
    tuple: (MINIMUM_LENGTH, PADDING_CHARACTER).</p>
<p>'number_style': Assume that the token is a number,
    either in the form of digits, Roman numerals, or
    number words like "thirty-seven". Convert it into
    the specified number format, which can be any of
    these:</p>
<div class="highlight"><pre><span></span><code>&#39;cardinal&#39;, e.g. &quot;twenty-seven&quot;

&#39;cardinal spaced&#39;, e.g. &quot;twenty seven&quot;

&#39;cardinal unspaced&#39;, e.g. &quot;twentyseven&quot;

&#39;ordinal&#39;, e.g. &quot;twenty-seventh&quot;

&#39;ordinal spaced&#39;, e.g. &quot;twenty seventh&quot;

&#39;ordinal unspaced&#39;, e.g. &quot;twentyseventh&quot;

&#39;roman numeral&#39;, e.g. &#39;xxvii&#39;

&#39;digit&#39;, e.g. &#39;27&#39;

Note that number formatting only works for positive
whole numbers that do not exceed 40.
</code></pre></div></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td></td>
        <td><p>any data that a given action needs specified, as
described above</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>mandatory</code></td>
        <td><code>bool</code></td>
        <td><p>whether a failed lookup or format action should
invalidate the entire citation</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>token</code></td>
        <td><code>str</code></td>
        <td><p>Necessary for operations in StringBuilders. This
value lets you provide the name of input token to use,
allowing you to then use the modify_dict() method.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>output</code></td>
        <td><code>str</code></td>
        <td><p>If this value is set, modify_dict() will save the
operation's output to the dictionary key with this name
instead of modifying the input token in place.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">mandatory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments:</span>
<span class="sd">        action: The kind of string manipulation that this operation</span>
<span class="sd">            will perform, using the given data. There are a few</span>
<span class="sd">            different options:</span>

<span class="sd">            &#39;sub&#39;: Regex substitution to perform on the text. Needs</span>
<span class="sd">                a list of two values: [PATTERN, REPLACEMENT]</span>

<span class="sd">            &#39;lookup&#39;: Check if the token matches any of the given</span>
<span class="sd">                regexes (via case-insensitive matching), and if so,</span>
<span class="sd">                replace it with the corresponding value. Needs a</span>
<span class="sd">                dictionary of `regex`: `replacement` pairs.</span>

<span class="sd">            &#39;case&#39;: Capitalize the token in the specified way.</span>
<span class="sd">                Options are &#39;upper&#39;, &#39;lower&#39;, and &#39;title&#39;.</span>

<span class="sd">            &#39;lpad&#39;: Left pad the token with zeros until it is the</span>
<span class="sd">                specified number of characters long. Requires an</span>
<span class="sd">                int specifying the number of characters. You can</span>
<span class="sd">                also specify the padding character by providing a</span>
<span class="sd">                tuple: (MINIMUM_LENGTH, PADDING_CHARACTER).</span>

<span class="sd">            &#39;number_style&#39;: Assume that the token is a number,</span>
<span class="sd">                either in the form of digits, Roman numerals, or</span>
<span class="sd">                number words like &quot;thirty-seven&quot;. Convert it into</span>
<span class="sd">                the specified number format, which can be any of</span>
<span class="sd">                these:</span>

<span class="sd">                &#39;cardinal&#39;, e.g. &quot;twenty-seven&quot;</span>

<span class="sd">                &#39;cardinal spaced&#39;, e.g. &quot;twenty seven&quot;</span>

<span class="sd">                &#39;cardinal unspaced&#39;, e.g. &quot;twentyseven&quot;</span>

<span class="sd">                &#39;ordinal&#39;, e.g. &quot;twenty-seventh&quot;</span>

<span class="sd">                &#39;ordinal spaced&#39;, e.g. &quot;twenty seventh&quot;</span>

<span class="sd">                &#39;ordinal unspaced&#39;, e.g. &quot;twentyseventh&quot;</span>

<span class="sd">                &#39;roman numeral&#39;, e.g. &#39;xxvii&#39;</span>

<span class="sd">                &#39;digit&#39;, e.g. &#39;27&#39;</span>

<span class="sd">                Note that number formatting only works for positive</span>
<span class="sd">                whole numbers that do not exceed 40.</span>

<span class="sd">        data: any data that a given action needs specified, as</span>
<span class="sd">            described above</span>

<span class="sd">        mandatory: whether a failed lookup or format action should</span>
<span class="sd">            invalidate the entire citation</span>

<span class="sd">        token: Necessary for operations in StringBuilders. This</span>
<span class="sd">            value lets you provide the name of input token to use,</span>
<span class="sd">            allowing you to then use the modify_dict() method.</span>

<span class="sd">        output: If this value is set, modify_dict() will save the</span>
<span class="sd">            operation&#39;s output to the dictionary key with this name</span>
<span class="sd">            instead of modifying the input token in place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;sub&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;lookup&#39;</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span><span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;case&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_case</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;lpad&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_pad</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;number_style&#39;</span><span class="p">:</span>
        <span class="n">action_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cardinal&#39;</span><span class="p">,</span> <span class="s1">&#39;ordinal&#39;</span><span class="p">,</span> <span class="s1">&#39;roman&#39;</span><span class="p">,</span> <span class="s1">&#39;digit&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action_options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s1"> is not a valid number style. Valid options: &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">action_options</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_number_style</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1"> is not a defined token operation.&#39;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mandatory</span> <span class="o">=</span> <span class="n">mandatory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenOperation.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>load a TokenOperation from a dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="s2">&quot;load a TokenOperation from a dictionary of values&quot;</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="s1">&#39;lookup&#39;</span><span class="p">,</span> <span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="s1">&#39;lpad&#39;</span><span class="p">,</span> <span class="s1">&#39;number style&#39;</span><span class="p">]:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">action_data</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">break</span>
    <span class="n">mandatory</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mandatory&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action_data</span><span class="p">,</span> <span class="n">mandatory</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenOperation.modify_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">modify_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>apply this operation to a dictionary of tokens,
editing them as appropriate</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">modify_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    apply this operation to a dictionary of tokens,</span>
<span class="sd">    editing them as appropriate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.TokenOperation.to_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save this TokenOperation to a dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s2">&quot;save this TokenOperation to a dictionary of values&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">output</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mandatory</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;mandatory&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">spaced_output</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">return</span> <span class="n">spaced_output</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="stringbuilder">StringBuilder</h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>A function to take a dictionary of values and use it to construct a
piece of text from them. This is used for citation templates' name
builders and URL builders. </p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>parts</code></td>
        <td></td>
        <td><p>A list of strings that will be concatenated to create the
string. Parts may contain bracketed references to citations'
token values as well as templates' metadata. If a part
references a token whose value is not set, the part will be
omitted from the created string.</p></td>
      </tr>
      <tr>
        <td><code>edits</code></td>
        <td></td>
        <td><p>A list of TokenOperations that will be performed on the
provided tokens before the string is constructed. If the
edits have <code>output</code> values, it is possible for them to
define entirely new tokens for the sole purpose of building
the string.</p></td>
      </tr>
      <tr>
        <td><code>defaults</code></td>
        <td></td>
        <td><p>A dictionary of default token values to use when not
overwritten by the citation. Generally these are provided by
the template's meta attribute.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StringBuilder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function to take a dictionary of values and use it to construct a</span>
<span class="sd">    piece of text from them. This is used for citation templates&#39; name</span>
<span class="sd">    builders and URL builders. </span>

<span class="sd">    Attributes:</span>
<span class="sd">        parts: A list of strings that will be concatenated to create the</span>
<span class="sd">            string. Parts may contain bracketed references to citations&#39;</span>
<span class="sd">            token values as well as templates&#39; metadata. If a part</span>
<span class="sd">            references a token whose value is not set, the part will be</span>
<span class="sd">            omitted from the created string.</span>
<span class="sd">        edits: A list of TokenOperations that will be performed on the</span>
<span class="sd">            provided tokens before the string is constructed. If the</span>
<span class="sd">            edits have `output` values, it is possible for them to</span>
<span class="sd">            define entirely new tokens for the sole purpose of building</span>
<span class="sd">            the string.</span>
<span class="sd">        defaults: A dictionary of default token values to use when not</span>
<span class="sd">            overwritten by the citation. Generally these are provided by</span>
<span class="sd">            the template&#39;s meta attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">edits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TokenOperation</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">defaults</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">parts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edits</span> <span class="o">=</span> <span class="n">edits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">defaults</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="s2">&quot;load StringBuilder from dictionary of values&quot;</span>
        <span class="n">edits</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">TokenOperation</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edits&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="p">]</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;parts&#39;</span><span class="p">]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defaults&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">edits</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="s2">&quot;save StringBuilder to a dictionary of values&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;edits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tokens</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>
            <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">defaults</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tokens</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">op</span><span class="o">.</span><span class="n">modify_dict</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span> <span class="c1"># token operation failed; just skip it</span>
                <span class="k">pass</span>
        <span class="n">string_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">string_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">tokens</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># skip parts that reference a nonexistent token</span>
                <span class="k">pass</span>
            <span class="c1"># if a mandatory TokenOperation failed, don&#39;t return a URL</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="n">string_parts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">break</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string_parts</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;StringBuilder(parts=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, edits=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;, defaults=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.StringBuilder.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>load StringBuilder from dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="s2">&quot;load StringBuilder from dictionary of values&quot;</span>
    <span class="n">edits</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TokenOperation</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;edits&#39;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;parts&#39;</span><span class="p">]</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;defaults&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">edits</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h3 id="citeurl.tokens.StringBuilder.to_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h3>

    <div class="doc doc-contents ">

      <p>save StringBuilder to a dictionary of values</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/tokens.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="s2">&quot;save StringBuilder to a dictionary of values&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;parts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="s1">&#39;edits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edits</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h2 id="insert_links">insert_links()</h2>


  <div class="doc doc-object doc-function">


    <div class="doc doc-contents first">

      <p>Convenience function to hyperlink all citations in a text. For more
info, see Citator.insert_links().</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">insert_links</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;citation&#39;</span><span class="p">},</span>
    <span class="n">add_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">URL_optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">redundant_links</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">id_breaks</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_markup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">citator</span><span class="p">:</span> <span class="n">Citator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to hyperlink all citations in a text. For more</span>
<span class="sd">    info, see Citator.insert_links().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citator</span> <span class="o">=</span> <span class="n">citator</span> <span class="ow">or</span> <span class="n">_get_default_citator</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">citator</span><span class="o">.</span><span class="n">insert_links</span><span class="p">(</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">,</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">,</span>
        <span class="n">add_title</span> <span class="o">=</span> <span class="n">add_title</span><span class="p">,</span>
        <span class="n">redundant_links</span> <span class="o">=</span> <span class="n">redundant_links</span><span class="p">,</span>
        <span class="n">id_breaks</span> <span class="o">=</span> <span class="n">id_breaks</span><span class="p">,</span>
        <span class="n">ignore_markup</span> <span class="o">=</span> <span class="n">ignore_markup</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h2 id="cite">cite()</h2>


  <div class="doc doc-object doc-function">


    <div class="doc doc-contents first">

      <p>Convenience function to find a single citation in text, or None. See
Citator.cite() for more info.</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cite</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">broad</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">citator</span><span class="p">:</span> <span class="n">Citator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Citation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to find a single citation in text, or None. See</span>
<span class="sd">    Citator.cite() for more info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citator</span> <span class="o">=</span> <span class="n">citator</span> <span class="ow">or</span> <span class="n">_get_default_citator</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">citator</span><span class="o">.</span><span class="n">cite</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">broad</span><span class="o">=</span><span class="n">broad</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

<h2 id="list_cites">list_cites()</h2>


  <div class="doc doc-object doc-function">


    <div class="doc doc-contents first">

      <p>Convenience function to list all citations in a text. For more info,
see Citator.list_cites().</p>

        <details class="quote">
          <summary>Source code in <code>citeurl/citator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">list_cites</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">citator</span><span class="p">:</span> <span class="n">Citator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">id_breaks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to list all citations in a text. For more info,</span>
<span class="sd">    see Citator.list_cites().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">citator</span> <span class="o">=</span> <span class="n">citator</span> <span class="ow">or</span> <span class="n">_get_default_citator</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">citator</span><span class="o">.</span><span class="n">list_cites</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">id_breaks</span><span class="o">=</span><span class="n">id_breaks</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../frontends/" class="md-footer__link md-footer__link--prev" aria-label="Previous: CiteURL Frontends" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              CiteURL Frontends
            </div>
          </div>
        </a>
      
      
        
        <a href="../template-yamls/" class="md-footer__link md-footer__link--next" aria-label="Next: Writing Your Own Templates" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Writing Your Own Templates
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.0bbba5b5.min.js", "version": "11.0.1"}</script>
    
    
      <script src="../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>