
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.5">
    
    
      
        <title>Writing Your Own Templates - CiteURL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.15aa0b43.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.75751829.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="pink">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#writing-your-own-templates" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="CiteURL" class="md-header-nav__button md-logo" aria-label="CiteURL">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            CiteURL
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Writing Your Own Templates
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/raindrum/citeurl/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CiteURL" class="md-nav__button md-logo" aria-label="CiteURL">
      
  <img src="../assets/logo.svg" alt="logo">

    </a>
    CiteURL
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/raindrum/citeurl/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../frontends/" class="md-nav__link">
        CiteURL Frontends
      </a>
    </li>
  

    
      
      
      


  
  
  
    <li class="md-nav__item">
      <a href="../library/" class="md-nav__link">
        Library Reference
      </a>
    </li>
  

    
      
      
      


  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Writing Your Own Templates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Writing Your Own Templates
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-basic-template-format" class="md-nav__link">
    The Basic Template Format
  </a>
  
    <nav class="md-nav" aria-label="The Basic Template Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regex-complications" class="md-nav__link">
    Regex Complications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url-complications" class="md-nav__link">
    URL Complications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-processing" class="md-nav__link">
    Token Processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recognizing-shortform-citations" class="md-nav__link">
    Recognizing Shortform Citations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous-keys" class="md-nav__link">
    Miscellaneous Keys
  </a>
  
    <nav class="md-nav" aria-label="Miscellaneous Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defaults" class="md-nav__link">
    defaults
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadregex" class="md-nav__link">
    broadRegex
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-basic-template-format" class="md-nav__link">
    The Basic Template Format
  </a>
  
    <nav class="md-nav" aria-label="The Basic Template Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regex-complications" class="md-nav__link">
    Regex Complications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url-complications" class="md-nav__link">
    URL Complications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#token-processing" class="md-nav__link">
    Token Processing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recognizing-shortform-citations" class="md-nav__link">
    Recognizing Shortform Citations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous-keys" class="md-nav__link">
    Miscellaneous Keys
  </a>
  
    <nav class="md-nav" aria-label="Miscellaneous Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defaults" class="md-nav__link">
    defaults
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadregex" class="md-nav__link">
    broadRegex
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/raindrum/citeurl/edit/master/docs_source/template-yamls.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="writing-your-own-templates">Writing Your Own Templates</h1>
<p>CiteURL supports a number of citation formats out-of-the box, and I try to add more when I can. However, it can never support every possible kind of citation, especially for local laws and countries outside the U.S.</p>
<p>For that reason, CiteURL is designed so that you can write your own citation templates in YAML format, and use them in various contexts:</p>
<ul>
<li>The <code>citeurl</code> command lets you can load these YAMLs with the <code>-s</code> option.</li>
<li>The <code>citeurl-makejs</code> command uses them to generate <a href="../frontends/#javascript">custom JavaScript search engines</a>.</li>
<li>The Python library lets you load YAMLs when <a href="../library/#citeurl.Citator.__init__">creating a Citator</a>, though you can also <a href="../library/#citeurl.Template.__init__">define templates at runtime</a>.</li>
</ul>
<p>This page details how to write these template files. Before you proceed, make sure you're at least a little familiar with <a href="https://docs.python.org/3/howto/regex.html">Python regex</a>, because the templates rely heavily on it. You'll also need some basic knowledge of <a href="https://www.w3schools.io/file/yaml-introduction/">YAML</a>.</p>
<p><strong>Note</strong>: <a href="https://github.com/raindrum/citeurl/blob/main/citeurl/builtin-templates.yaml">CiteURL's built-in templates</a> are written in the same YAML format described on this page, so they are a good resource to help you write your own. You can also find a step-by-step summary of how each template works by opening a browser console with <code>ctrl+shift+i</code> while using <a href="https://raindrum.github.io/lawsearch">Law Search</a>.</p>
<h2 id="the-basic-template-format">The Basic Template Format</h2>
<p>Here is a simplified example of a template that you might write to recognize citations to the U.S. Code:</p>
<div class="highlight"><pre><span></span><code><span class="nt">United States Code</span><span class="p">:</span>
  <span class="nt">regex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(?P&lt;title&gt;\d+) USC § (?P&lt;section&gt;\d+)</span>
  <span class="nt">URL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.law.cornell.edu/uscode/text/{title}/{section}</span>
</code></pre></div>
<p>This citation template recognizes any series of one or more digits, followed by " USC § ", followed by another series of digits. It knows that the first string of digits is something called a "title" and the second is a "section". We will call these stored values <code>tokens</code>.</p>
<p>Finally, the template also has a pattern to generate a URL based on the recognized citation. It does this by replacing the placeholders (i.e. the parts in curly braces) with the values from the captured tokens. Although this template does not have any, it could also define <a href="#token-processing">operations</a> to perform on the captured tokens before inserting them into the URL.</p>
<h3 id="regex-complications">Regex Complications</h3>
<p>In the example above, the regex is provided as a single string. This is perfectly valid, but templates' regexes can be much more complicated than that, for two reasons:</p>
<ol>
<li>A regex can be provided either as a string (as shown above), <em>or</em> as a list of strings. In the latter case, they will be concatenated (with no spaces) to create the actual regex. There is no functional difference between using strings and lists, except that providing them in list form allows you to reuse common regex parts using <a href="https://medium.com/@kinghuang/docker-compose-anchors-aliases-extensions-a1e4105d70bd">YAML anchors</a>.</li>
<li>Independent of the first reason, it is possible to give a template <em>multiple</em> regexes to match, by using the <code>regexes</code> key instead of <code>regex</code>. Normally, this will not be necessary, because the usual solution is to just write one regex to recognize multiple citation formats. However, regexes are limited in that capture groups cannot be rearranged.</li>
</ol>
<p>The example template above can be rewritten to take advantage of these two features, like so:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">United States Code</span>
  <span class="l l-Scalar l-Scalar-Plain">regexes</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nl">&amp;title</span> <span class="s">&#39;(?P&lt;title&gt;\d+)&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;</span><span class="nv"> </span><span class="s">USC</span><span class="nv"> </span><span class="s">&#39;</span><span class="p p-Indicator">,</span> <span class="nl">&amp;section</span> <span class="s">&#39;(Section|§)</span><span class="nv"> </span><span class="s">(?P&lt;section&gt;\d+)&#39;</span><span class="p p-Indicator">]</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">*section</span><span class="p p-Indicator">,</span> <span class="s">&#39;</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Title</span><span class="nv"> </span><span class="s">&#39;</span><span class="p p-Indicator">,</span> <span class="nv">*title</span><span class="p p-Indicator">,</span> <span class="s">&#39;</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">United</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Code&#39;</span><span class="p p-Indicator">]</span>
<span class=" -Error">  </span><span class="nt">URL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.law.cornell.edu/uscode/text/{title}/{section}</span>
</code></pre></div>
<p>The above template looks unwieldy, and it is; its regex is a list of lists. However, it provides two advantages over the first example:</p>
<p>First, it is possible to recognize both "42 USC § 1983" and "Section 1983 of Title 42 of the United States Code," which would be impossible with a single regex, since <code>title</code> and <code>section</code> are in a different order.</p>
<p>Second, by using YAML anchors it is possible to reuse common pieces of regex, like <code>*section</code>, which can recognize either the word "Section" or a section sign ("§"). This can make it much easier to write and maintain large libraries of templates.</p>
<h3 id="url-complications">URL Complications</h3>
<p>Another important feature is that a template's URL, like its regex(es), can be specified as a list of strings to concatenate. Unlike with regexes, splitting a URL into a list of strings makes it function differently: If a list item contains a placeholder for which no value is set, that whole list item will be omitted from the final URL. For instance, the template below can generate anchor links to subsections of the U.S. Code, but if no subsection is specified, it simply links to the overall page for the section itself:</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">United States Code</span>
  <span class="l l-Scalar l-Scalar-Plain">regex</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">(?P&lt;title&gt;\d+) USC § (?P&lt;section&gt;\d+)( \((?P&lt;subsection&gt;[a-z])\)?</span>
  <span class="l l-Scalar l-Scalar-Plain">URL</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;https://www.law.cornell.edu/uscode/text/{title}/{section}&#39;</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;#{subsection}&#39;</span>
</code></pre></div>
<h2 id="token-processing">Token Processing</h2>
<p>In many cases, the tokens matched in a citation won't directly correspond with the values that need to be inserted into the URL placeholder. For example, your template might detect a court reporter called "F. App'x." or "Pa. D. &amp; C.4th", but <a href="https://case.law/">Case.Law</a>'s URL scheme needs those reporters to be called "<a href="https://cite.case.law/f-appx/">f-appx</a>" and "<a href="https://cite.case.law/pa-d-c4th/">pa-d-c4th</a>", respectively.</p>
<p>To solve this problem, CiteURL templates can specify <code>operations</code> that will be performed on the dictionary of matched tokens to turn them into a new dictionary (i.e. <code>processed_tokens</code>) before using it to populate the URL.</p>
<p>This example template solves the problem by converting the <code>reporter</code> token to lowercase, deleting some common special characters from it, and then replacing spaces with dashes:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Caselaw Access Project (Simplified)</span><span class="p">:</span>
  <span class="nt">regex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(?P&lt;volume&gt;\d+) (?P&lt;reporter&gt;(\D|\d(d|th|rd))+?) (?P&lt;page&gt;\d+)</span>
  <span class="nt">operations</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reporter</span>
      <span class="nt">case</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lower</span>
    <span class="p p-Indicator">-</span> <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reporter</span>
      <span class="nt">sub</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;[.()&amp;,&#39;]&quot;</span><span class="p p-Indicator">,</span> <span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span>
    <span class="p p-Indicator">-</span> <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reporter</span>
      <span class="nt">sub</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&#39;</span><span class="nv"> </span><span class="s">&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;-&#39;</span><span class="p p-Indicator">]</span>
  <span class="nt">URL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://cite.case.law/{reporter}/{volume}/{page}</span>
</code></pre></div>
<p>As shown above, a template's <code>operations</code> value is a list of operations that will be performed in sequence. Each operation is a dictionary that must specify a <code>token</code> to process, and the kind of operation to perform. Operations process a token in place by default, but if an <code>output</code> is specified, that token will be set or modified instead.</p>
<p>The above example shows two kinds of operation: case modification (<code>case</code>), and regex substitution (<code>sub</code>), but CiteURL supports others as well:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Description</th>
<th>Required Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>case</code></td>
<td>sets the input token to the specified capitalization</td>
<td><code>upper</code>, <code>lower</code>, or <code>title</code></td>
</tr>
<tr>
<td><code>sub</code></td>
<td>replaces all instances of the provided regex pattern with the replacement string</td>
<td><code>[PATTERN, REPL]</code></td>
</tr>
<tr>
<td><code>lookup</code></td>
<td>uses case-insensitive regex matching to check the token against each pattern until it fully matches one of them, in which case it outputs the corresponding replacement string. If no pattern is matched, it causes the entire template match to retroactively fail, as if there had never been a regex match in the first place.</td>
<td><code>{PATTERN: REPL, PATTERN: REPL ...}</code></td>
</tr>
<tr>
<td><code>optionalLookup</code></td>
<td>same as <code>lookup</code>, except that if the lookup fails, it simply proceeds without modifying any tokens</td>
<td><code>{PATTERN: REPL, PATTERN: REPL ...}</code></td>
</tr>
<tr>
<td><code>lpad</code></td>
<td>adds zeros to the beginning of the token until it is the specified length</td>
<td>an integer</td>
</tr>
<tr>
<td><code>numberFormat</code></td>
<td>assumes that the token is an integer in digit or roman numeral form, and converts it to the specified form, irrespective of which format it was originally in. The outputted roman numerals are capitalized.</td>
<td><code>roman</code> or <code>digit</code></td>
</tr>
</tbody>
</table>
<p>One final note: If an operation's input token has not been set (as distinct from being set to an empty string), the operation will be skipped.</p>
<h2 id="recognizing-shortform-citations">Recognizing Shortform Citations</h2>
<p>Often, once a particular authority is cited once, subsequent references to it will take a shorter, more contextual format. For example, if a text cites <em>United States v. An Article Consisting of Boxes of Clacker Balls</em>, 413 F. Supp. 1281 (E.D. Wis. 1976), then immediately cites a specific page of it, the second citation might look something like "<em>Id</em>. at 1284." Later, once a different authority has been cited in the interim, the same citation might be referred back to with a citation like "413 F. Supp. at 1289."</p>
<p>To address this, CiteURL can essentially generate new templates on the fly, whenever it detects a citation. These templates can be of two forms: <code>shortForms</code> and <code>idForms</code>. In each case, the template is only applied to text after the original long-form citation. The difference is that <code>shortForms</code> are applied to <em>all</em> of the remaining text, whereas <code>idForms</code> are only matched against the text in between one citation and the next. Note that the <a href="../library/#citeurl.Citator.list_citations">Citator.list_citations()</a> function also accepts an interruption regex, all occurrences of which will break chains of <code>idForm</code> citations.</p>
<p>Like URL templates, <code>idForms</code> and <code>shortForms</code> may contain placeholders in curly braces. These placeholders will be replaced with the corresponding token matched in the long-form citation, so that you can ensure that they only match citations where those tokens are unchanged. For instance, you could write a template to recognize court cases:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Caselaw Access Project (Simplified)</span><span class="p">:</span>
  <span class="nt">regex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(?P&lt;volume&gt;\d+) (?P&lt;reporter&gt;(\D|\d(d|th|rd))+?) (?P&lt;page&gt;\d+)(, (?P&lt;pincite&gt;\d+))?</span>
  <span class="nt">idForms</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Id\. at (?P&lt;pincite&gt;\d+)</span>
  <span class="nt">shortForms</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">volume</span><span class="p p-Indicator">}</span> <span class="p p-Indicator">{</span><span class="nv">reporter</span><span class="p p-Indicator">}</span> <span class="l l-Scalar l-Scalar-Plain">at (?P&lt;pincite&gt;\d+)</span>
</code></pre></div>
<p>This template will recognize long-form citations like 372 U.S. 335 (optionally with a pincite citation afterwards). After that long-form citation is recognized, it will generate the regex <code>372 U\.S\. at (?P&lt;pincite&gt;\d+)</code>, to recognize later citations to different pincites in the same case.</p>
<p>To be precise, placeholders are replaced by the text <em>as originally matched</em> in the original regex capture group, before any <a href="#token-processing">operations</a> are applied. This is normally the desired behavior, since operations often turn a token into something that would never be recognized. An exception applies where the placeholder refers to a token that only exists after operations are applied. In those cases, the processed token is used.</p>
<p>This exception is useful in a few situations. For instance, a California court opinion might reference "California Civil Code § 1946.2" once early on, but then shift to a format like "CIV § 1946.2" in later citations. This poses a problem because the new form drops reference to California, so it's too generic to be its own long-form citation, while at the same time it doesn't match the "Civil Code" token, either. But this can be solved by using a substitution to recognize "Civil Code" and, from it, generate a new token "CIV", then generating a short citation form from that:</p>
<div class="highlight"><pre><span></span><code><span class="nt">California Codes</span><span class="p">:</span>
  <span class="nt">regex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">California (?P&lt;code&gt;Civil Code|Penal Code) § (?P&lt;section&gt;\d+)</span>
  <span class="nt">operations</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">code</span>
      <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">abbreviatedCode</span>
      <span class="nt">lookup</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="s">&#39;Civil</span><span class="nv"> </span><span class="s">Code&#39;</span><span class="p p-Indicator">:</span><span class="s">&#39;CIV&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;Penal</span><span class="nv"> </span><span class="s">Code&#39;</span><span class="p p-Indicator">:</span><span class="s">&#39;PEN&#39;</span><span class="p p-Indicator">}</span>
  <span class="nt">shortForms</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">abbreviatedCode</span><span class="p p-Indicator">}</span> <span class="l l-Scalar l-Scalar-Plain">§ (?P&lt;section&gt;\d+)</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">code</span><span class="p p-Indicator">}</span> <span class="l l-Scalar l-Scalar-Plain">§ (?P&lt;section&gt;\d+)</span>
</code></pre></div>
<p>Using the example template above, CiteURL will be able to recognize a longform citation to "California Civil Code § 1946.2", and then recognize subsequent citations <em>either</em> to "Civil Code" sections <em>or</em> "CIV" sections.</p>
<p>One last note: Unlike a template's <code>regex</code>, <code>shortForms</code> and <code>idForms</code> are inherently lists, since they are designed to allow multiple alternative regexes. However, like the <code>regex</code> entry, individual list items can optionally be lists of strings, to accommodate YAML anchors. For instance, the following template is functionally identical to the Caselaw Access Project example above; the only difference is that I structured it so that I would only need to write <code>(?P&lt;pincite&gt;\d+)</code> once:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Caselaw Access Project (Simplified)</span><span class="p">:</span>
  <span class="nt">regex</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;(?P&lt;volume&gt;\d+)</span><span class="nv"> </span><span class="s">(?P&lt;reporter&gt;(\D|\d(d|th|rd))+?)</span><span class="nv"> </span><span class="s">(?P&lt;page&gt;\d+)(,</span><span class="nv"> </span><span class="s">&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nl">&amp;pin</span> <span class="s">&#39;(?P&lt;pincite&gt;\d+)&#39;</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;)?&#39;</span>
  <span class="nt">idForms</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="s">&#39;Id\.</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">&#39;</span><span class="p p-Indicator">,</span> <span class="nv">*pin</span><span class="p p-Indicator">]</span>
  <span class="nt">shortForms</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="s">&#39;{volume}</span><span class="nv"> </span><span class="s">{reporter}</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">&#39;</span><span class="p p-Indicator">,</span> <span class="nv">*pin</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h2 id="miscellaneous-keys">Miscellaneous Keys</h2>
<h3 id="defaults">defaults</h3>
<p><code>defaults</code> is a dictionary of tokens whose values will be set to specified values, if they are not set by a named capture group in the matched regex. Defaults are applied prior to any <a href="#token-processing">operations</a>.</p>
<p>For instance, the template below will match citations like "29 USC § 157" as well as citations like "§ 1983", but in the latter case, it assumes that the title is '42' by default.</p>
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">U.S. Code, but especially Title 42</span><span class="p p-Indicator">:</span>
  <span class="nt">regex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((?P&lt;title&gt;\d+) USC )?§ (?P&lt;section&gt;\d+)</span>
  <span class="nt">defaults</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="s">&#39;title&#39;</span><span class="p p-Indicator">:</span> <span class="s">&#39;42&#39;</span><span class="p p-Indicator">}</span>
</code></pre></div>
<h3 id="broadregex">broadRegex</h3>
<p><code>broadRegex</code> and <code>broadRegexes</code> are identical in format to the <code>regex</code> and <code>regexes</code> keys. They allow you to specify extra regexes that will be used, in addition to the normal regex(es), in contexts like search engines where user convenience is more important than avoiding false positives. </p>
<p>BroadRegexes are used by default in the <a href="../library/#citeurl.Template.lookup">lookup()</a> method, as well as in <a href="../frontends#javascript">JavaScript implementations</a>, though if you are writing templates <em>exclusively</em> for these use cases rather than text processing, it is not important whether you use <code>regexes</code> or <code>broadRegexes</code>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../library/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Library Reference
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.93c04032.min.js"></script>
      <script src="../assets/javascripts/bundle.83e5331e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>